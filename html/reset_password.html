<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="description" content="Responsive Password Reset Form" />
    <meta name="keywords" content="Password Reset, Responsive Form, HTML, CSS, JS" />
    <meta name="author" content="Monujaan Wadde" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Password Reset</title>
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }

        body {
            background: url("../backimg/formimg.jpg") no-repeat center/cover;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }

        .form_reset {
            position: relative;
            width: 100%;
            max-width: 380px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 30px 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form_close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            color: #fff;
            background: #ff0000;
            border: 2px solid #7c7c7c;
            border-radius: 50%;
            cursor: pointer;
            padding: 2px 7px;
            transition: transform 0.2s ease;
        }

        .form_close:hover {
            transform: rotate(90deg);
            background: #00ff33;
        }

        .form_reset h2 {
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 22px;
            letter-spacing: 0.5px;
        }

        .input_box {
            margin-bottom: 18px;
            position: relative;
        }

        .input_box input {
            width: 100%;
            padding: 12px 40px 12px 14px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            transition: 0.3s;
        }

        .input_box input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .input_box input:focus {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 2px #3b82f6;
        }

        .input_box input.valid {
            box-shadow: 0 0 0 2px #22c55e;
        }

        .input_box input.invalid {
            box-shadow: 0 0 0 2px #ef4444;
        }

        .error {
            color: red;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .password-wrapper {
            position: relative;
        }

        .pw_hide {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 18px;
            color: #ffffff;
        }

        .button {
            width: 100%;
            background: linear-gradient(135deg, #ff0077, #3b82f6);
            color: #fff;
            padding: 12px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
        }

        /* Popup Styles */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .popup-content {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            width: 320px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .popup-content p {
            margin-bottom: 15px;
            font-size: 15px;
            color: #333;
        }

        .popup-content button {
            padding: 8px 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .popup-content button:hover {
            background: #45a049;
        }
    </style>
</head>

<body>

    <div class="form_reset">
        <i class="uil uil-times form_close" id="formClose" title="Close"></i>
        <form id="resetForm">
            <h2>Reset Password</h2>

            <!-- Password -->
            <div class="input_box">
                <div class="password-wrapper">
                    <input type="password" id="password" placeholder="New Password" autocomplete="off" required />
                    <i class="uil uil-eye-slash pw_hide"></i>
                </div>
                <div class="error" id="passError">Password must be strong</div>
            </div>

            <!-- Confirm -->
            <div class="input_box">
                <div class="password-wrapper">
                    <input type="password" id="confirmPassword" placeholder="Confirm Password" autocomplete="off"
                        required />
                    <i class="uil uil-eye-slash pw_hide"></i>
                </div>
                <div class="error" id="confirmError">Passwords do not match</div>
            </div>

            <button class="button" type="submit">Update Now</button>
        </form>
    </div>

    <!-- Popup -->
    <div class="popup" id="popup">
        <div class="popup-content">
            <p id="popupMessage"></p>
            <button id="closePopup">OK</button>
        </div>
    </div>

    <!-- jQuery + Ripples -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.ripples/0.5.3/jquery.ripples.min.js"></script>
    <script>
        const passInput = document.getElementById("password");
        const confirmInput = document.getElementById("confirmPassword");
        const passError = document.getElementById("passError");
        const confirmError = document.getElementById("confirmError");
        const form = document.getElementById("resetForm");
        const popup = document.getElementById("popup");
        const popupMessage = document.getElementById("popupMessage");
        const closePopup = document.getElementById("closePopup");

        function showPopup(message, redirect = null) {
            popupMessage.innerHTML = message;
            popup.style.display = "flex";
            closePopup.onclick = () => {
                popup.style.display = "none";
                if (redirect) window.location.href = redirect;
            };
        }

        // âœ… Strong password validation
        function validatePassword() {
            const val = passInput.value.trim();
            if (val === "") {
                passInput.classList.remove("valid", "invalid");
                passError.style.display = "none";
                return false;
            }

            // Strong password regex (more strict & universal)
            const strong = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&^#])[A-Za-z\d@$!%*?&^#]{8,}$/;

            if (!strong.test(val)) {
                passInput.classList.add("invalid");
                passInput.classList.remove("valid");
                passError.textContent =
                    "Password must be at least 8 characters, include upper, lower, number & special character.";
                passError.style.display = "block";
                return false;
            }

            passInput.classList.add("valid");
            passInput.classList.remove("invalid");
            passError.style.display = "none";
            return true;
        }

        // âœ… Confirm password validation
        function validateConfirm() {
            const val = confirmInput.value.trim();
            if (val === "") {
                confirmInput.classList.remove("valid", "invalid");
                confirmError.style.display = "none";
                return false;
            }

            if (val !== passInput.value) {
                confirmInput.classList.add("invalid");
                confirmInput.classList.remove("valid");
                confirmError.textContent = "Passwords do not match.";
                confirmError.style.display = "block";
                return false;
            }

            confirmInput.classList.add("valid");
            confirmInput.classList.remove("invalid");
            confirmError.style.display = "none";
            return true;
        }

        passInput.addEventListener("input", validatePassword);
        confirmInput.addEventListener("input", validateConfirm);

        // âœ… Final submit check
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            if (!validatePassword() || !validateConfirm()) return;

            fetch("../php/reset_password.php", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams({
                    password: passInput.value,
                    confirmPassword: confirmInput.value
                })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.status === "success") {
                        showPopup(data.message, "login.html");
                    } else {
                        showPopup(data.message);
                    }
                })
                .catch(err => {
                    showPopup("Error connecting to server.");
                    console.error(err);
                });
        });

        // Toggle show/hide password
        document.querySelectorAll(".pw_hide").forEach(icon => {
            icon.addEventListener("click", () => {
                const input = icon.previousElementSibling;
                input.type = input.type === "password" ? "text" : "password";
                icon.classList.toggle("uil-eye");
                icon.classList.toggle("uil-eye-slash");
            });
        });

        document.getElementById("formClose").addEventListener("click", () => {
            window.location.href = "login.html";
        });

        // ðŸŒŠ Water ripple effect
        $("body").ripples({
            resolution: 512,
            dropRadius: 20,
            perturbance: 0.04,
        });

        $("body").on("click", function (e) {
            const $el = $(this);
            const x = e.pageX - $el.offset().left;
            const y = e.pageY - $el.offset().top;
            $el.ripples("drop", x, y, 20, 0.04);
        });
    </script>
</body>
</html>